<h1 style="font-size: 2.5rem; color: #1e3c72; margin-bottom: 2rem; text-align: center;">
  üõí Your Shopping Cart
</h1>

<% if @cart_items.any? %>
  <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; align-items: start;">

    <!-- Cart Items -->
    <div>
      <% @cart_items.each do |item| %>
        <div style="background: white; border-radius: 10px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
          <div style="display: grid; grid-template-columns: 120px 1fr auto; gap: 1.5rem; align-items: center;">

            <!-- Product Image -->
            <div style="width: 120px; height: 120px; background: #f5f5f5; border-radius: 5px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
              <% if item[:product].images.attached? && item[:product].images.first.present? %>
                <%= link_to product_path(item[:product]) do %>
                  <%= image_tag item[:product].images.first,
                                style: "width: 100%; height: 100%; object-fit: cover;",
                                alt: item[:product].name %>
                <% end %>
              <% else %>
                <div style="color: #999; font-size: 2rem;">üì¶</div>
              <% end %>
            </div>

            <!-- Product Details -->
            <div>
              <h3 style="font-size: 1.2rem; color: #2c3e50; margin-bottom: 0.5rem;">
                <%= link_to item[:product].name, product_path(item[:product]), style: "color: inherit; text-decoration: none;" %>
              </h3>

              <div style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 1rem;">
                <%= truncate(item[:product].description, length: 100) %>
              </div>

              <div style="display: flex; gap: 2rem; align-items: center;">
                <div>
                  <div style="color: #7f8c8d; font-size: 0.8rem;">Price</div>
                  <div style="font-size: 1.3rem; font-weight: bold; color: #1e3c72;">
                    ‚Ç¶<%= number_with_delimiter(item[:product].price.to_i) %>
                  </div>
                </div>

                <div>
                  <div style="color: #7f8c8d; font-size: 0.8rem;">Quantity</div>
                  <%= form_with url: update_quantity_cart_path(id: item[:product].id), method: :patch, local: true, style: "display: flex; gap: 0.5rem; align-items: center; margin-top: 0.5rem;" do %>
                    <button type="button"
                            onclick="this.nextElementSibling.stepDown(); this.closest('form').submit();"
                            style="width: 30px; height: 30px; background: #ecf0f1; border: none; border-radius: 3px; cursor: pointer; font-weight: bold; color: #7f8c8d;">
                      ‚àí
                    </button>

                    <%= number_field_tag :quantity, item[:quantity],
                        min: 0,
                        max: item[:product].stock_quantity,
                        style: "width: 60px; text-align: center; border: 2px solid #ddd; border-radius: 3px; padding: 0.25rem;",
                        onchange: "this.form.submit();" %>

                    <button type="button"
                            onclick="this.previousElementSibling.stepUp(); this.closest('form').submit();"
                            style="width: 30px; height: 30px; background: #ecf0f1; border: none; border-radius: 3px; cursor: pointer; font-weight: bold; color: #7f8c8d;">
                      +
                    </button>
                  <% end %>
                  <div style="font-size: 0.75rem; color: #95a5a6; margin-top: 0.25rem;">
                    Max: <%= item[:product].stock_quantity %>
                  </div>
                </div>

                <div>
                  <div style="color: #7f8c8d; font-size: 0.8rem;">Line Total</div>
                  <div style="font-size: 1.3rem; font-weight: bold; color: #27ae60;">
                    ‚Ç¶<%= number_with_delimiter(item[:line_total].to_i) %>
                  </div>
                </div>
              </div>
            </div>

            <!-- Remove Button -->
            <div>
              <%= link_to remove_cart_path(id: item[:product].id),
                          method: :delete,
                          data: { confirm: "Remove #{item[:product].name} from cart?" },
                          style: "background: #e74c3c; color: white; padding: 0.75rem 1.5rem; border-radius: 5px; text-decoration: none; font-weight: bold; display: inline-block; white-space: nowrap;" do %>
                üóëÔ∏è Remove
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Clear Cart Button -->
      <div style="text-align: center; margin-top: 2rem;">
        <%= link_to "Clear Entire Cart",
                    clear_cart_path,
                    method: :delete,
                    data: { confirm: "Are you sure you want to clear your entire cart?" },
                    style: "color: #e74c3c; text-decoration: none; font-weight: bold;" %>
      </div>
    </div>

    <!-- Cart Summary -->
    <div style="background: white; border-radius: 10px; padding: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 20px;">
      <h2 style="font-size: 1.5rem; color: #2c3e50; margin-bottom: 1.5rem; border-bottom: 2px solid #ecf0f1; padding-bottom: 1rem;">
        Cart Summary
      </h2>

      <div style="margin-bottom: 1.5rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem; color: #7f8c8d;">
          <span>Items in cart:</span>
          <span style="font-weight: bold;"><%= @cart_items.sum { |item| item[:quantity] } %></span>
        </div>

        <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 2px solid #ecf0f1;">
          <span style="color: #7f8c8d;">Subtotal:</span>
          <span style="font-size: 1.5rem; font-weight: bold; color: #1e3c72;">
            ‚Ç¶<%= number_with_delimiter(@cart_total.to_i) %>
          </span>
        </div>

        <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 5px; padding: 1rem; margin-bottom: 1.5rem; font-size: 0.9rem; color: #856404;">
          üìù Taxes and shipping will be calculated at checkout based on your province.
        </div>
      </div>

      <div style="margin-top: 2rem;">
        <%= link_to new_order_path,
            style: "background: #27ae60; color: white; padding: 1rem; border-radius: 5px; text-align: center; font-size: 1.1rem; font-weight: bold; display: block; text-decoration: none; margin-bottom: 1rem;",
            onmouseover: "this.style.background='#229954'",
            onmouseout: "this.style.background='#27ae60'" do %>
          üõçÔ∏è Proceed to Checkout
        <% end %>

        <%= link_to "‚Üê Continue Shopping", products_path,
                    style: "display: block; text-align: center; color: #1e3c72; text-decoration: none; font-weight: bold;" %>
      </div>
    </div>
  </div>

<% else %>
  <!-- Empty Cart State -->
  <div style="text-align: center; padding: 4rem 2rem; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div style="font-size: 5rem; margin-bottom: 1rem;">üõí</div>
    <h2 style="font-size: 2rem; color: #7f8c8d; margin-bottom: 1rem;">Your cart is empty</h2>
    <p style="color: #95a5a6; margin-bottom: 2rem; font-size: 1.1rem;">
      Looks like you haven't added any items to your cart yet.
    </p>
    <%= link_to "Start Shopping", products_path,
                style: "background: #1e3c72; color: white; padding: 1rem 2rem; border-radius: 5px; text-decoration: none; font-size: 1.1rem; font-weight: bold; display: inline-block;" %>
  </div>
<% end %>